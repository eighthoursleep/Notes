# UE4蓝图

UE4蓝图是一种可视化玩法脚本语言，它基于将节点从左连到右的点图机制。

蓝图可以制作成品游戏或者简单/复杂的游戏机制，比如控制门的关闭开启。

蓝图的最大优势是不需要程序员来搭建逻辑关系。



## 3种蓝图

除了关卡蓝图，所有蓝图类型都是在内容浏览器里创建。

### 关卡蓝图

“关卡（Level）”是指UE种制成的游戏场景。

关卡蓝图用于制作当前游戏场景的程序。

可以说，再UE中进行的编程就是在创建关卡蓝图。

关卡蓝图没法手动创建，是包含在关卡里的。

关卡蓝图在关卡被加载后可以访问。

你可以引用场景里的任何资源并且与之互动。

如果你在关卡蓝图里引用了一个蓝图类，你可以访问这个类的所有公共变量和公共函数。

关卡蓝图的优点是可以轻松访问关卡里的actor，直接引用无需转换类型。这有助于在创建一些不在关卡里触发的事件或调用的函数。

要创建关卡中的资源，可以先选中要访问的资源，然后在关卡蓝图里右键，选择`Create a Reference to XXX`。

### 游戏模式

游戏模式（GameMode）是与制作中的游戏整体相关的设置、动作。

### 类蓝图

类（Class）是集中处理几个相关功能及数据的小型程序。创建类会使结构整体一目了然。

蓝图类使用最普遍，因为它自带玩法机制，而且可以在多个关卡里复用。

蓝图类继承自原始C++类。

创建蓝图类的方法：右键内容浏览器，在“新建基础资源”下边选择蓝图类。

## 图表编辑器的基本操作

显示位置的移动（鼠标右键拖拽）

显示的缩放（鼠标滚轮）

节点的创建、选择、移动、删除、复制、粘贴、连接、断开连接（右击连接项目中的一方，在弹出的菜单中选择“断开到xxx的连接”命令）

程序运行（编译、保存、播放）

## 节点

在UE中，一个蓝图节点可以代表事件、流程控制操作、函数、变量等。一个节点的源码可以很简单也可以很复杂。

开发者可以到蓝图编辑面板，用C++写自己的节点。

### 节点的构成

基本上所有的节点都由以下3部分构成：

- 标题：在节点的上方显示，会根据节点的**类型**而显示不同的**颜色**。

- 输入引脚：显示在节点左侧，用于**从其他节点接收数据**。

- 输出引脚：显示在节点右侧，用于**传递数据到其他节点**。

在蓝图中，处理操作是按“从左至右”的顺序执行。

排布节点时，将最先执行的放在最左边，然后依次向右侧排列，比较容易连接。

### 重要的3种节点

#### 事件节点（event node）

当用户操作或者游戏场景中发生了某件事时，会触发事件，类似于一种信号。

事件节点的标题显示为**红色**。

例子：事件BeginPlay节点。

#### 执行节点

特征：

- 左右两侧都有白色的五角形引脚
- 蓝色标题

例子：PrintString节点。

#### 读取节点

特征：

- 没有设定处理顺序的白色五角形引脚，即不能从事件连接到该节点。
- 绿色标题

作用：向其他结点传递必要的信息。

### 展开节点的信息显示

例如PrintString节点，点击下方的三角形可以展开/隐藏其他项目。展开我们可以看到多了以下项目：

Print to Screen：是否将文本打印到画面上；

Print to Log：是否将文本记录在日志或记录执行状况等的文件中；

Text Color：文本颜色。

### 关于创建节点的菜单

#### 选项的显示顺序

如果在关卡编辑器上选择了3D空间中配置的部件，那么在弹出的创建节点菜单上方会显示经常使用的、与该部件有关的选项，同时其他选项会顺移到其下方。

#### 情境关联

注意菜单右上方的“情境关联”复选框。

其功能时显示与当前状态关联度高的节点。

除此之外，如果勾选了，经常使用的东西或者重要的东西会转化为中文显示，如果不勾选，则全部以英文显示。

情景关联是ON还是OFF，显示的内容是不同的，如果在检索时找不到目标选项，可以看一下情境关联是否打开了。

### 节点注释和注释组

右击节点，显示的菜单最下方有“节点注释”项。在节点注释项输入文本内容可以立即显示。

选中要注释的多个节点后，再任意节点上右击，再弹出的菜单选择“从选中项中创建注释”，可以将这些节点全部包围起来，然后在注释标题框输入文本内容即可。

## 变量与计算

### 值的类型

文本、字符串（Text、String）

整型、浮点型（Int、Float）

布尔型（Bool）

常用的创建值的节点：`Make Literal String`、`Make Literal Int`。

### 数学表达式节点



### 蓝图变量

变量的细节的几个项：

**可编辑**：表示是否公开编辑该变量，为了在公开的蓝图实例上能够处理变量。

**工具提示**：当鼠标悬停到该变量上时，显示该变量的工具提示信息。

**在生成时显示**：设置生成此蓝图时，是否让此变量显示为引脚。

**私有**：限制所有外部访问的属性。

**显示到Matinee**：控制这个变量是否要暴露给Matinee以进行修改。

**分类**：指定变量的类别，方便整理。

**复制**：规定是否应该通过网络复制这个变量。

## 流程控制

### 分支

分支节点（Branch）:2选1

开关节点（Switch）：多选1

例如：`Switch On String`节点、`Switch On Int`节点

### 循环

#### ForLoop循环

输入项：

- Exec输入项：位于最上方的白色五角形，用于连接执行处理的顺序。
- First Index：为计数器设置的初始值。
- Last Index：计数器的结束值。当达Index到该值后，执行完循环处理后直接进入之后的处理中。

输出项：

- Loop Body：用于连接循环所执行的处理。多次执行连接到此处的处理。
- Index：取出当前计数器的值。想知道是第几次循环时使用。
- Completed：连接循环完成后的处理。循环结束后，进入连接到此处的处理。

#### ForEachLoop循环

输入：

- Exec输入项：连接执行处理的顺序。
- Array：连接要处理的数组

输出：

- Loop Body：将循环处理的内容连接至此以创建处理。
- Array Element：在ForEachLoop中将以顺序从数组中取出值，所取出的值从此处获得。
- Array Index：可获得取出值的Index编号。
- Completed：数组完成后，用于连接至之后的处理。

#### WhileLoop条件循环

输入：

- Condition：检查循环，每次循环都会检查Condition是否为真，为真则继续执行循环，为假则退出循环。

输出：

- Loop Body：用于连接循环所执行的处理。Condition为真时执行。
- Completed：用于连接循环结束后进行的处理。Condition为j假时执行。

### 程序结构化

#### 合并节点

#### 宏与函数

### 事件

#### 自定义事件

#### 带Break的Loop

ForLoopWithBreak、ForEachLoopWithBreak

#### 触发器（FlipFlop）

#### 序列



## Actor的基本操作



### Transform

### 键盘移动

### 鼠标输入



## 材质的编程



## 蓝图接口

蓝图接口是蓝图的一种特殊类型，分为函数和变量。

## 蓝图宏指令库
