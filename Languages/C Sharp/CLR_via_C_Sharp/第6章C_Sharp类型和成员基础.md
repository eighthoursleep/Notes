# C#类型和成员基础

本文介绍如何在类型中定义各种成员、从而设计出符合需求的类型。

[TOC]

## 类型的各种成员

类型中可以定义0个或多个以下种类的成员：
- 常量
- 字段
- 实例构造器
- 类型构造器
- 方法
- 操作符重载
- 转换操作符
- 属性
- 事件
- 类型

**常量**是指数据值恒定不变的符号。这种符号使代码更易阅读和维护。

常量总与类型关联，不予类型的实例关联。

常量逻辑上总是静态成员。

**字段**表示只读或可读/可写的数据值。

字段可以是静态的；这种字段被认为是类型状态的一部分。

字段也可以是实例（非静态）；这种字段被认为是对象状态的一部分。

强烈建议将字段声明为私有，防止类型或对象的状态被类型外部的代码破坏。

**实例构造器**是将新对象的实例字段初始化为良好初始状态的特殊方法。

**类型构造器**是将类型的静态字段初始化为良好初始状态的特殊方法。

**方法**是更改或查询类型或i对象状态的函数。作用于类型称为静态方法，作用于对象称为实例方法。

方法通常要读写类型或对象的字段。

**操作符重载**实际是方法，定义了当操作符作用于对象时，应该如何操作该对象。

由于不是所有编程语言都支持操作符重载，所以操作符重载方法不是“公共语言规范”（CLS）的一部分。

**转换操作符**是定义如何隐式或显式将对象从一种类型转型为另一种类型的方法。

和操作符重载方法一样，转换操作符并不是所有编程语言都支持转换操作符，所以不是CLS的一部分。

**属性**允许用简单的、字段风格的语法设置或查询类型或对象的逻辑状态，同时保证状态不被破坏。作用于类型称为静态属性，作用于对象称为实例属性。

属性可以无参（非常普遍），也可以有多个参数（相当少见，但集合类用得多）。

**静态事件**允许类型向一个或多个静态或实例方法发送通知。

**实例（非静态）事件**允许对象向一个或多个静态或实例方法发送通知。

引发事件通常是为了响应提供事件的类型或对象的状态的改变。

**事件**包含两个方法，允许静态或实例方法登记或注销对该事件的关注。除了这两个方法，事件通常还用一个委托字段来维护已登记的方法集。

**类型**可以定义其他嵌套类型。通常用这个办法将大的、复杂的类型分解成更小的构建单元（building block）以简化实现。

无论什么编程语言，编译器都必须能处理源代码，为上述每种成员生成元数据和IL代码。

所有编程语言生成的元数据格式完全一致。这是CLR成为“公共语言运行时”的原因。

**元数据**是所有语言都生成和使用的公共信息。

有了元数据，用一种语言写的代码才能无缝范围跟另一种语言写的代码。

以下C#代码展示了一个类型定义，其中包含所有可能的成员。
```c#
using System;

public sealed class SomeType
{
    //嵌套类
    private class SomeNestedType{}

    //常量、只读和静态可读/可写字段
    private const Int32 c_SomeConstant = 1;
    private readonly String m_SomeReadOnlyField = "2";
    private static Int32 s_SomeReadWriteField = 3;

    //类型构造器
    static SomeType(){}

    //实例构造器
    public SomeType(Int32 x){}
    public SomeType(){}

    //实例方法和静态方法
    private String InstanceMethod(){ return null;}
    public static void Main(){}

    //实例属性
    public Int32 SomeProp
    {
        get { return 0;}
        set{}
    }

    //实例有参属性（索引器）
    public Int32 this[String s]
    {
        get{return 0;}
        set{}
    }
    //实例事件
    public event EventHandler SomeEvent;
}
```

## 类型的可见性

要定义文件范围的可见性而不是将类型定义嵌套到另一个类型中。

定义文件范围的类型时，可将类型的可见性指定为public或internal。

public类型不仅对定义程序集中的所有代码可见，还对其他程序集中的代码可见。

internal类型则仅对定义程序集中的所有代码可见，对其他程序集中的代码不可见。

定义类型时不显式指定可见性，C#编译器会帮你指定为internal。

### 友元程序集



## 成员的可访问性

## 静态类

## 分布类、结构和接口

## 组件、多态和版本控制