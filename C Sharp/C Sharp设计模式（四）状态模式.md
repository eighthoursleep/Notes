---
title: C#设计模式（四）状态模式
date: 2020-08-09 21:12:00
tags: C Sharp
toc: true
categories: 设计模式
---

环境类实现状态转换、状态模式的优点、状态模式的缺点、适用环境

<!--more-->

在软件系统中，有些对象具有多种状态，这些状态在某些情况下能够互相转换。对象在不同的状态下将具有不同的行为复杂的条件判断语句来进行状态的判断和转换操作，导致代码的可维护性和灵活性下降，出现新的状态时，代码的扩展性很差，客户端代码也需要进行相应的修改，违背了开闭原则。

差劲的写法：

```c#
class TestXYZ
{
    int behaviour;
    ...
    public void HandleAll()
    {
        if(behaviour == 0)
            //...
        else if(behaviour = 1)
            //...
        else if(behaviour = 2)
            //...
        else if(behaviour = 3)
            //...
        else
        {
            //...
        }  
    }
}
```



# 定义

状态模式允许一个对象在其内部状态改变时改变它的行为。对象看起来似乎修改了它的类。对象行为型模式，又名状态对象（Object for State）

用于解决系统中复杂对象的状态转换以及不同状态下行为的封装问题，将一个对象的状态从该对象中分离出来，封闭到专门的状态中，使得对象状态可以灵活变化。

对于客户端而言，无须关心对象状态的转换以及对象所处的当前状态，无论对于何种状态的对象，客户端都可以一致处理。

# 结构

状态模式包含3个角色：Context(环境类)、State(抽象状态类)、ConcreteState(具体状态类)



# 代码



# 实例说明

某软件公司要为一个银行开发一套信用卡业务系统，银行账户（Account）是该系统的核心类之一，通过分析，该软件公司开发人员发现在系统中的核心类之一，通过分析，该软件公司开发人员发现在系统中国账户存在3种状态，且在不同状态下账户存在不同的行为，具体如下：

1. 如果账户中余额大于等于0，则账户的状态为正常状态（Normal State），此时用户既可以向该账户存款也可以从该账户取款；
2. 如果账户中余额小于0，并且大于-2000，则账户的状态为透支状态（Overdraft State），此时用户既可以向该账户存款也可以从该账户取款，但需要按天计算利息；
3. 如果账户中余额等于-2000，那么账户的状态为受限状态（Restricted State），此时用户只能向该账户存款，不能再从中取款，同时也将按天计算利息；
4. 根据余额的不同，以上3种状态可发生相互转换。现使用状态设计模式并实现严恒状态的转换。



# 共享状态



实例说明



# 使用环境类实现状态转换



# 状态模式的优点



# 状态模式的缺点



# 适用环境